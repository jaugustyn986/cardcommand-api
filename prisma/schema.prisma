// ============================================
// CardCommand Center - Database Schema
// ============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// Enums
// ============================================

enum Category {
  basketball
  baseball
  football
  hockey
  soccer
  pokemon
  mtg
  yugioh
  one_piece
  digimon
  lorcana
}

enum Liquidity {
  High
  Medium
  Low
}

enum Plan {
  free
  premium
  pro
}

enum UserStatus {
  active
  inactive
  suspended
}

// ============================================
// Models
// ============================================

model User {
  id            String          @id @default(uuid())
  email         String          @unique
  password      String
  name          String?
  plan          Plan            @default(free)
  status        UserStatus      @default(active)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  preferences   UserPreferences?
  portfolio     PortfolioItem[]
  trackedDeals  TrackedDeal[]
}

model UserPreferences {
  id                    String   @id @default(uuid())
  userId                String   @unique
  categories            String[]
  priceRangeMin         Float    @default(0)
  priceRangeMax         Float    @default(0)
  grades                String[]
  graders               String[]
  dealAlertThreshold    Float    @default(20)
  notificationChannels  String[]

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Deal {
  id              String   @id @default(uuid())
  cardName        String
  cardSet         String
  year            Int
  cardNumber      String?
  variation       String?
  grade           String
  grader          String?
  marketPrice     Float
  dealPrice       Float
  savingsPercent  Float
  savingsAmount   Float
  marketplace     String
  sellerRating    Float
  sellerFeedback  Int
  listingUrl      String
  imageUrl        String?
  category        Category
  liquidity       Liquidity
  lastSoldPrice   Float?
  thirtyDayAvg    Float?
  ninetyDayTrend  Float?
  popGraded       Int?
  popGrade10      Int?
  isActive        Boolean  @default(true)
  expiresAt       DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  trackedBy       TrackedDeal[]
  strategy        Json?

  @@index([category])
  @@index([isActive])
  @@index([createdAt])
}

model TrackedDeal {
  id        String   @id @default(uuid())
  userId    String
  dealId    String
  createdAt DateTime @default(now())

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  deal  Deal  @relation(fields: [dealId], references: [id], onDelete: Cascade)

  @@unique([userId, dealId])
}

model PortfolioItem {
  id              String   @id @default(uuid())
  userId          String
  cardName        String
  cardSet         String
  year            Int
  grade           String
  grader          String?
  currentValue    Float
  purchasePrice   Float
  purchaseDate    DateTime @default(now())
  quantity        Int      @default(1)
  imageUrl        String?
  notes           String?
  inGradingQueue  Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Release {
  id              String   @id @default(uuid())
  name            String
  releaseDate     DateTime
  category        Category
  manufacturer    String
  msrp            Float
  estimatedResale Float?
  hypeScore       Float?
  imageUrl        String?
  topChases       String[]
  printRun        String?
  description     String?
  isReleased      Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model TrendingItem {
  id              String   @id @default(uuid())
  cardName        String
  cardSet         String
  category        Category
  currentPrice    Float
  priceChange24h  Float    @default(0)
  priceChange7d   Float    @default(0)
  priceChange30d  Float    @default(0)
  volumeIncrease  Float    @default(0)
  searchVolume    Int      @default(0)
  sentiment       String   @default("Neutral")
  calculatedAt    DateTime @default(now())
}
